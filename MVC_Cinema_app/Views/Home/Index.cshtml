@model GenreViewModel
@{
    ViewData["Title"] = "Головна";
}

<div class="container">
    <main>
        <section class="banner">
            <div class="banner-card">
                <img src="~/image/posters/big_posters/Mufasa_king_banner.jpg" alt="banner" class="banner-img">

                <div class="card-content">
                    <div class="card-info">
                        <div class="genre">
                            <ion-icon name="film"></ion-icon>
                            <span>Сімений/Пригоди/Мультфільм</span>
                        </div>

                        <div class="year">
                            <ion-icon name="calendar"></ion-icon>
                            <span>2024</span>
                        </div>

                        <div class="duration">
                            <ion-icon name="time"></ion-icon>
                            <span>1г 58хв</span>
                        </div>
                    </div>
                    <h2 class="card-title">Муфаса: Король Лев</h2>
                </div>
            </div>
        </section>

        <section class="movies">
            <div class="filter-bar">
                <div class="filter-dropdowns">
                    <select asp-for="SelectedGenreId" asp-items="Model.GenreOptions" class="genre" id="genreDropdown">
                        <option value="all genres">Всі жанри</option>
                    </select>

                    <select name="year" class="year">
                        <option value="all years">Всі роки</option>
                        <option value="2025">2025</option>
                        <option value="2020-2024">2020-2024</option>
                        <option value="2010-2019">2010-2019</option>
                        <option value="2000-2009">2000-2009</option>
                        <option value="1980-1999">1980-1999</option>
                    </select>
                </div>

                <div class="filter-radios">
                    <input type="radio" name="grade" id="featured" checked>
                    <label for="featured">Рекомендовані</label>

                    <input type="radio" name="grade" id="popular">
                    <label for="popular">Популярні</label>

                    <input type="radio" name="grade" id="newest">
                    <label for="newest">Нові</label>

                    <div class="checked-radio-bg"></div>
                </div>
            </div>

            <div class="movies-grid" id="moviesGrid">
                <!-- Карточки фільмів будуть додані динамічно ось тут-->
                @foreach (var movieViewModel in Model.Movies)
                {
                    <a asp-action="Details" asp-route-id="@movieViewModel.Movie.Id">
                    <div class="movie-card visible">
                        <div class="card-head">
                            <img src="@movieViewModel.Movie.PosterURL" alt="movie" class="card-img">
                            <div class="card-overlay">
                                <div class="bookmark">
                                    <ion-icon name="bookmark"></ion-icon>
                                </div>
                                <div class="rating">
                                    <ion-icon name="star-outline"></ion-icon>
                                    <span>@movieViewModel.Movie.Rating</span>
                                </div>
                                <div class="play">
                                    <ion-icon name="play-circle-outline"></ion-icon>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h3 class="card-title">@movieViewModel.Movie.Title</h3>
                            <div class="card-info">
                                <span class="genre">@movieViewModel.Movie.GenreName</span>
                            </div>
                            <div class="card-info">
                                <span class="year">@movieViewModel.Movie.ReleaseDate</span>
                            </div>
                        </div>
                    </div>
                    </a>
                }
            </div>
            <button class="load-more">Завантажити ще</button>
        </section>

        <section class="category" id="category">
            <h2 class="section-heading">Категорії</h2>

            <div class="category-grid">
                <div class="category-card">
                    <img src="https://i.postimg.cc/JzfWFmfC/action.jpg" alt="image" class="card-img">
                    <div class="name">Бойовик</div>
                    <div class="total">2</div>
                </div>

                <div class="category-card">
                    <img src="https://i.postimg.cc/CKpxqjL8/comedy.jpg" alt="image" class="card-img">
                    <div class="name">Комедія</div>
                    <div class="total">2</div>
                </div>

                <div class="category-card">
                    <img src="https://i.postimg.cc/3rfrBMxY/thriller.webp" alt="image" class="card-img">
                    <div class="name">Триллер</div>
                    <div class="total">0</div>
                </div>

                <div class="category-card">
                    <img src="https://i.postimg.cc/HkXpdV4k/horror.jpg" alt="image" class="card-img">
                    <div class="name">Жахи</div>
                    <div class="total">0</div>
                </div>

                <div class="category-card">
                    <img src="https://i.postimg.cc/qRRVhRnn/adventure.jpg" alt="image" class="card-img">
                    <div class="name">Пригоди</div>
                    <div class="total">0</div>
                </div>

                <div class="category-card">
                    <img src="https://i.postimg.cc/15pmZ8K5/animated.jpg" alt="image" class="card-img">
                    <div class="name">Анімація</div>
                    <div class="total">0</div>
                </div>

                <div class="category-card">
                    <img src="https://i.postimg.cc/XvX6Xq95/crime.jpg" alt="image" class="card-img">
                    <div class="name">Крімінальний</div>
                    <div class="total">0</div>
                </div>

                <div class="category-card">
                    <img src="https://i.postimg.cc/8568BYKP/sci-fi.jpg" alt="image" class="card-img">
                    <div class="name">Наукова фантастика</div>
                    <div class="total">0</div>
                </div>
            </div>
        </section>
    </main>
</div>

<!-- Movie Details Modal -->
<div class="modal fade" id="movieDetailsModal" tabindex="-1" aria-labelledby="movieDetailsLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="movieTitle"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body d-flex flex-column">
                <div class="d-flex align-items-start mb-4">
                    <!-- Movie Poster (Left) -->
                    <img id="moviePoster" class="img-fluid rounded" alt="Movie Poster" style="max-width: 200px; height: auto; margin-right: 20px;">

                    <!-- Movie Details (Right) -->
                    <div>
                        <h5><strong>Genre:</strong> <span id="movieGenre"></span></h5>
                        <p><strong>Rating:</strong> <span id="movieRating"></span></p>
                        <p><strong>Release Date:</strong> <span id="movieReleaseDate"></span></p>
                        <p><strong>Description:</strong> <span id="movieDescription"></span></p>
                    </div>
                </div>

                <!-- Sessions Section -->
                <div class="sessions-section">
                    <h5>Available Sessions:</h5>
                    <div id="movieSessions" class="sessions-grid"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
<script src="~/js/site.js"></script>
<!-- Bootstrap Bundle (Includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="~/js/movies.js"></script>
<!-- <script src="~/js/tmdb.js"></script> -->

<script>
        document.addEventListener("DOMContentLoaded", function () {
        let movieDetailsModal = document.getElementById("movieDetailsModal");

        movieDetailsModal.addEventListener("show.bs.modal", function (event) {
            let movieCard = event.relatedTarget;

            // Extract movie details from data attributes
            let title = movieCard.getAttribute("data-title");
            let genre = movieCard.getAttribute("data-genre");
            let rating = movieCard.getAttribute("data-rating");
            let releaseDate = movieCard.getAttribute("data-release-date");
            let description = movieCard.getAttribute("data-description");
            let poster = movieCard.getAttribute("data-poster");
            let sessions = movieCard.getAttribute("data-sessions");

            // Populate basic movie info
            document.getElementById("movieTitle").innerText = title;
            document.getElementById("movieGenre").innerText = genre;
            document.getElementById("movieRating").innerText = rating;
            document.getElementById("movieReleaseDate").innerText = releaseDate;
            document.getElementById("movieDescription").innerText = description;
            document.getElementById("moviePoster").setAttribute("src", poster);

            // Populate sessions
            const sessionsContainer = document.getElementById("movieSessions");
            sessionsContainer.innerHTML = ''; // Clear existing sessions

            if (sessions) {
                const sessionsList = sessions.split(',');
                sessionsList.forEach(session => {
                    const [date, time, price] = session.split('|');
                    const sessionElement = document.createElement('div');
                    sessionElement.className = 'session-item';
                    sessionElement.innerHTML = `
                        <div class="session-time">${date}</div>
                        <div class="session-time">${time}</div>
                        <div class="session-price">${price} грн</div>
                        <button class="btn btn-primary btn-sm">Купити квиток</button>
                    `;
                    sessionsContainer.appendChild(sessionElement);
                });
            } else {
                sessionsContainer.innerHTML = '<p>Немає доступних сеансів</p>';
            }
        });
    });
</script>